<?xml version="1.0" encoding="UTF-8"?>
<object-views xmlns="http://axelor.com/xml/ns/object-views"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://axelor.com/xml/ns/object-views
       http://axelor.com/xml/ns/object-views/object-views_5.4.xsd">
       
    <grid model="com.axelor.gst.db.Invoice" title="Invoices" name="invoice-grid">
        <field name="status"/>
        <field name="company"/>
        <field name="reference"/>
        <field name="dates"/>
        <field name="party"/>
        <field name="partyContact"/>
        <field name="invoiceAddress"/>
        <field name="shippingAddress"/>
        <field name="netAmount"/>
        <field name="netIgst"/>
        <field name="netCsgt"/>
        <field name="netSgst"/>
        <field name="grossAmount"/>
    </grid>   
       
    <form model="com.axelor.gst.db.Invoice" title="Invoices" name="invoice-form" onNew="action-onGroup-for-all" width="large" onSave="action-OnSave-update-defaults-fields">
        <panel title="Invoices" name="invoices">
        <field name="status" showTitle="false" widget="NavSelect" colSpan="12"/>
        <field name="reference" colSpan="12"/>
        <field name="company"/>
        <field name="dates"/>
        <field name="party" onChange="action-onChange-party-update-partyContact,action-onChange-update-shipping-field"/>
        <field name="partyContact"/>
        <field name="invoiceAddress"/>
        <field name="shippingAddress" hideIf="useInvoiceAddressAsShipping == true"/>
        <field name="useInvoiceAddressAsShipping" />
        <field name="netAmount"/>
        <field name="netIgst"/>
        <field name="netCsgt"/>
        <field name="netSgst"/>
        <field name="grossAmount"/>
          <panel-related field="invoiceItems" colSpan="12"/>
        </panel>
        <panel sidebar="true">
          <button onClick="bttn-to-change-status,bttn-to-change-title,save" name="clickMeBtn" title="validate" />  <!-- -->
        </panel>
        
    </form>
       
       
       <action-group name="action-onGroup-for-all">
          <action name="action-onNew-fill-invoice"/>
          <action name="action-onNew-get-company"/>
       </action-group>
       
       <action-record name="action-onNew-fill-invoice" model="com.axelor.gst.db.Invoice">
           <field name="dates" expr="eval: __datetime__"/> 
            <field name="status" expr="draft"/>
       </action-record>
      
      <action-record name="action-onNew-get-company" model="com.axelor.gst.db.Invoice" >
           <field name="company" expr="eval: __repo__(Company).all().fetchOne()"/> 
      </action-record>
   
      <action-attrs name="bttn-to-change-status">
          <!-- <attribute name="value" for="status" expr="draft" /> -->
          <attribute name="value" for="status" expr="validated" if="status == 'draft'"/>
          <attribute name="value" for="status" expr="paid" if="status == 'validated'"/>
          <attribute name="value" for="status" expr="cancelled" if="status == 'paid'"/>
          <attribute name="value" for="status" expr="draft" if="status == 'cancelled'"/>
      </action-attrs>
      
       <action-attrs name="bttn-to-change-title">
          <!-- <attribute name="title" for="clickMeBtn" expr="draft"/>  -->
          <!-- <attribute name="title" for="clickMeBtn" expr="validated" />  -->
          <attribute name="title" for="clickMeBtn" expr="paid" if="status == 'validated'"/>
          <attribute name="title" for="clickMeBtn" expr="cancelled" if="status == 'paid'"/>
           <attribute name="title" for="clickMeBtn" expr="draft" if="status == 'cancelled'"/>
           <attribute name="title" for="clickMeBtn" expr="validate" if="status == 'draft'"/>
      </action-attrs>
      
     <action-method name="action-onChange-party-update-partyContact" model="com.axelor.gst.db.Invoice">
        <call class="com.axelor.gst.Controller.PartyController" method="primaryContact"/>
     </action-method>
     
       <action-method name="action-onChange-update-shipping-field" model="com.axelor.gst.db.Invoice">
           <call class="com.axelor.gst.Controller.PartyController" method="shippingAddress"/>
       </action-method>
     
     
     <action-attrs name="action-OnSave-update-defaults-fields" model="com.axelor.gst.db.InvoiceLine">
         <attribute name="value" for="netAmount" expr="invoiceItems.netAmount"/>
     </action-attrs>
     
 </object-views>      