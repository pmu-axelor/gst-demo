<?xml version="1.0" encoding="UTF-8"?>
<object-views xmlns="http://axelor.com/xml/ns/object-views"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://axelor.com/xml/ns/object-views
       http://axelor.com/xml/ns/object-views/object-views_5.4.xsd">
       
    <grid model="com.axelor.gst.db.Invoice" title="Invoices" name="invoice-grid">
        <field name="status"/>
        <field name="company"/>
        <field name="reference"/>
        <field name="dates"/>
        <field name="party"/>
        <field name="partyContact"/>
        <field name="invoiceAddress"/>
        <field name="shippingAddress"/>
        <field name="netAmount"/>
        <field name="netIgst"/>
        <field name="netCsgt"/>
        <field name="netSgst"/>
        <field name="grossAmount"/>
    </grid>   
       
    <form model="com.axelor.gst.db.Invoice" title="Invoices" name="invoice-form" onNew="action-onNew-fill-invoice" width="large" > <!--  onSave="action-OnSave-update-defaults-fields" -->
        <panel title="Invoices" name="invoices">
        <field name="status" showTitle="false" widget="NavSelect" colSpan="12" />
        <field name="reference" colSpan="12"/>
        <field name="company"/>
        <field name="dates"/>
        <field name="party" onChange="action-onChange-party-update-partyContactAndAddresses"/>  
        <field name="partyContact"/>
        <field name="invoiceAddress"/>
        <field name="shippingAddress" /> <!-- hideIf="useInvoiceAddressAsShipping == true" -->
        <field name="useInvoiceAddressAsShipping" widget="boolean-switch" />  <!-- onChange="action-onChange-update-shipping-field" -->
        <field name="netAmount"/>
        <field name="netIgst"/>
        <field name="netCsgt"/>
        <field name="netSgst"/>
        <field name="grossAmount"/>
          <panel-related field="invoiceItems" form-view="invoiceLine-form" grid-view="invoiceLine-grid" colSpan="12" onChange="action-OnSave-update-defaults-fields"/>
        </panel>
        <panel sidebar="true" hideIf="(status == 'paid') || (status == 'cancelled')">
          <button onClick="bttn-to-change-status,bttn-to-change-title,action-onSave-get-sequence-invoice,save" name="clickMeBtn" title="validate" hideIf="status == 'cancelled'" />
          <button onClick="bttn-to-update-status-for-cancelled" name="BtnCancelled" title="cancelled" css="btn-danger" hideIf="status == 'cancelled'" />  
        </panel>
   </form>
       
     <kanban columnBy="status" model="com.axelor.gst.db.Invoice" sequenceBy="priority" title="Invoices" name="kanban-invoice" draggable="true" limit="2">
             <field name="reference"/>
             <field name="company"/>
             <field name="dates"/>
             <field name="netAmount"/>
             <field name="netIgst"/>
             <field name="netCsgt"/>
             <field name="netSgst"/>
             <field name="grossAmount"/>
        <template>
              <![CDATA[
                 <div>
                       <h3>Reference:</h3>
                       <h4>{{record.reference}}</h4>
                       <h3>Company:</h3>
                       <h4>{{record.company.name}}</h4>
                       <h3>Date:</h3>
                       <h4>{{record.dates}}</h4>
                        <h3>Net Amount:</h3>
                       <h4>{{record.netAmount}}</h4>
                        <h3>Net Igst:</h3>
                       <h4>{{record.netIgst}}</h4>
                        <h3>Net Csgt:</h3>
                       <h4>{{record.netCsgt}}</h4>
                        <h3>Net Sgst:</h3>
                       <h4>{{record.netSgst}}</h4>
                        <h3>Gross Amount:</h3>
                       <h4>{{record.grossAmount}}</h4>
                 </div>
              ]]>
        </template>
       </kanban>
       
   <!--     <action-group name="action-onGroup-for-all">
          <action name="action-onNew-fill-invoice"/>
          <action name="action-onNew-get-company"/>
       </action-group> -->
       
       <action-record name="action-onNew-fill-invoice" model="com.axelor.gst.db.Invoice">
            <field name="dates" expr="eval: __datetime__"/> 
            <field name="status" expr="draft"/> 
            <field name="company" expr="eval: __repo__(Company).all().fetchOne()"/>
       </action-record>
      
      <!-- <action-record name="action-onNew-get-company" model="com.axelor.gst.db.Invoice" >
           <field name="company" expr="eval: __repo__(Company).all().fetchOne()"/> 
      </action-record> -->
   
      <action-attrs name="bttn-to-change-status">
           <attribute name="value" for="status" expr="validated" if="status == 'draft'"/>
          <attribute name="value" for="status" expr="paid" if="status == 'validated'" />
           <!-- <attribute name="value" for="status" expr="draft" if="status == 'paid'"/> -->
        </action-attrs>
      
       <action-attrs name="bttn-to-change-title">   <!-- " -->
          <attribute name="title" for="clickMeBtn" expr="paid" if="status == 'validated'"/>
        <!--   <attribute name="title" for="clickMeBtn" expr="draft" if="status == 'paid'"/>  
          <attribute name="title" for="clickMeBtn" expr="validate" if="status == 'draft'"/> -->
       </action-attrs>
      
      <action-attrs name="bttn-to-update-status-for-cancelled">
         <attribute name="value" for="status" expr="cancelled" if="status == 'draft'" />
         <attribute name="value" for="status" expr="cancelled" if="status == 'validated'"/>
         <!-- <attribute name="hidden" for="BtnCancelled" expr="eval: status == 'paid'"/> -->
      </action-attrs>
      
     <action-method name="action-onChange-party-update-partyContactAndAddresses" model="com.axelor.gst.db.Invoice">
        <call class="com.axelor.gst.Controller.AddressController" method="setPrimaryContactAndAddresses"/>
     </action-method>
     
       <!-- <action-method name="action-onChange-update-shipping-field" model="com.axelor.gst.db.Invoice">
           <call class="com.axelor.gst.Controller.PartyController" method="shippingAddress"/>
       </action-method> -->
     
     
         <action-method name="action-OnSave-update-defaults-fields" model="com.axelor.gst.db.Invoice">
           <call class="com.axelor.gst.Controller.InvoiceController" method="setInvoiceItems"/>
         </action-method>
         
         <action-method name="action-onSave-get-sequence-invoice" model="com.axelor.gst.db.Invoice">
             <call class="com.axelor.gst.Controller.InvoiceController" method="generateSequence"/>
         </action-method>
     
 </object-views>      