<?xml version="1.0" encoding="UTF-8"?>
 <object-views xmlns="http://axelor.com/xml/ns/object-views"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://axelor.com/xml/ns/object-views
       http://axelor.com/xml/ns/object-views/object-views_5.4.xsd">
       
  <chart name="chart-for-unpaid-invoice" title="Unpaid invoices per customer">
      <search-fields>
          <field name="fromDate" title="From Date" type="date"/>
          <field name="toDate" title="To Date" type="date"/>
       </search-fields> 
     <dataset type="jpql">
         <![CDATA[
            SELECT
                  COUNT(self.reference) AS reference,
                   MONTH(self.date) AS month,
                  _party.name AS customer
            FROM 
               Invoice self
             LEFT JOIN 
                 self.party AS _party 
              WHERE
                 self.status = 'validated' AND _party.customer = 't' 
                AND self.date BETWEEN :fromDate
                 AND :toDate
                 GROUP BY 
                      self.date,
                      _party.name  
                    ORDER BY
                      month   
             ]]>
     </dataset>
     <category key="month" type="month"/>  
     <series key="reference " groupBy="customer" type="bar"/>
    <!--  <config name="colors" value="red,green" /> -->
  </chart>  
   
   <chart name="chart-for-paid-invoices" title="Paid invoices per category per product">
     <search-fields>
          <field name="fromDte" title="From Date" type="date"/>
          <field name="toDte" title="To Date" type="date"/>
       </search-fields> 
       <dataset type="jpql">
          <![CDATA[
                SELECT
                      COUNT(_invoice.reference) AS reference,
                      MONTH(_invoice.date) AS month,
                     _product.name AS pName,
                     _category.name AS category
                    FROM 
                       InvoiceLine self
                    LEFT JOIN 
                       self.invoice AS _invoice 
                    LEFT JOIN
                        self.product AS _product
                     LEFT JOIN 
                        _product.category AS _category
                     WHERE 
                      _invoice.status = 'paid' AND 
                      _invoice.date>= :fromDte AND
                      _invoice.date<= :toDte
                     GROUP BY
                           _invoice.date,
                            _product.name,
                            _category.name  
                       
          ]]>
       </dataset>
        <category key="category" type="text"/>
        <series key="reference" type="bar" groupBy="pName"/>
   </chart>
   
   <chart name="chart-for-customer-per-state" title="Customer per State">
       <dataset type="jpql">
          <![CDATA[
                SELECT 
                     Count(self.isCustomer) AS customer,
                    _address.state AS state,
                    _state.name AS sName
                FROM
                     Party self
                LEFT JOIN 
                     self.addressList AS _address
                LEFT JOIN 
                      _address.state as _state    
                WHERE 
                     self.isCustomer = 't'
                GROUP BY
                       _address.state,
                       _state.id,     
                       _state.name   
          ]]>
       </dataset>
       <category key="sName" />
       <series key="customer" groupBy="state" type="pie"/>
   </chart>
   
   <chart name="chart-for-invoices-per-status" title="Invoices per status">
       <dataset type="jpql">
            <![CDATA[
                  SELECT  
                       COUNT(self.reference) as reference,
                        SUM(self.grossAmount) as amount,
                          self.status as status
                   FROM 
                        Invoice self
                   WHERE
                        self.status = 'validated' OR self.status = 'paid'
                   GROUP BY
                        self.status, 
                        self.grossAmount          
               ]]>
       </dataset>
       <category key="reference" type="text" />
       <series key="amount" groupBy="status" type="bar" title="Amount"/>
   </chart>
   
   <chart name="chart-for-invoices-per-status-number-of-invoices" title="Invoices per status">
       <dataset type="jpql">
            <![CDATA[
                  SELECT 
                        COUNT(self.id) as total,
                        COUNT(self.reference) as reference,
                         self.status as status
                   FROM 
                        Invoice self
                   WHERE
                        self.status = 'validated' OR self.status = 'paid'
                   GROUP BY
                        self.status, 
                        self.grossAmount          
               ]]>
       </dataset>
       <category key="reference" type="text"/>
       <series key="total" groupBy="status" type="line"/>
   </chart>
        
 </object-views>      